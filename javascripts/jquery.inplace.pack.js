jQuery.fn.editInPlace=function(a){var b={url:"",params:"",method:"POST",field_type:"text",select_options:"",textarea_cols:"25",textarea_rows:"10",datepicker:"",saving_text:"Saving...",saving_image:"",default_text:"(Click here to add text)",select_text:"Choose new value",value_required:null,element_id:"element_id",update_value:"update_value",original_html:"original_html",save_button:'<input type="submit" class="inplace_save" value="Save"/>',cancel_button:'<input type="submit" class="inplace_cancel" value="Cancel"/>',callback:null,success:null,error:function(d){alert("Failed to save value: "+d.responseText||"Unspecified Error")}};if(a){jQuery.extend(b,a)}if(b.saving_image!=""){var c=new Image();c.src=b.saving_image}String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")};String.prototype.escape_html=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};return this.each(function(){if(jQuery(this).html()==""){jQuery(this).html(b.default_text)}var d=false;var e=jQuery(this);var f=0;jQuery(this).mouseover(function(){jQuery(this).addClass("inplace_hover")}).mouseout(function(){jQuery(this).removeClass("inplace_hover")}).click(function(){f++;if(!d){d=true;var l=jQuery(this).html();var p=b.save_button+" "+b.cancel_button;if(l==b.default_text){jQuery(this).html("")}if(b.field_type=="textarea"){var o='<textarea name="inplace_value" class="inplace_field" rows="'+b.textarea_rows+'" cols="'+b.textarea_cols+'">'+jQuery(this).text().trim().escape_html()+"</textarea>"}else{if(b.field_type=="text"){var o='<input type="text" id="inplace_field" name="inplace_value" class="inplace_field" value="'+jQuery(this).text().trim().escape_html()+'" />'}else{if(b.field_type=="select"){var m=b.select_options;if(typeof m=="string"){m=m.split(",")}var o='<select name="inplace_value" class="inplace_field"><option value="">'+b.select_text+"</option>";for(var k=0;k<m.length;k++){var g=m[k];if(typeof g=="string"){g=g.split(":")}var n=g[1]||g[0];var j=n==l?'selected="selected" ':"";o+="<option "+j+'value="'+n.trim().escape_html()+'">'+g[0].trim().escape_html()+"</option>"}o+="</select>"}}}jQuery(this).html('<form class="inplace_form" style="display: inline; margin: 0; padding: 0;">'+o+" "+p+"</form>");if(b.datepicker=="datepicker"){var h={yearRange:"1900:2007",dateFormat:"MM d, yy",defaultDate:new Date(1980,1-1,1)};jQuery.extend(h,b.datepicker_options);$("#inplace_field").datepicker(h)}}if(f==1){e.children("form").children(".inplace_field").focus().select();$(document).keyup(function(i){if(i.keyCode==27){d=false;f=0;e.css("background",b.bg_out);e.html(l);return false}});e.children("form").children(".inplace_cancel").click(function(){d=false;f=0;e.css("background",b.bg_out);e.html(l);return false});e.children("form").children(".inplace_save").click(function(){e.css("background",b.bg_out);var q=jQuery(this).parent().children(0).val();if(b.saving_image!=""){var i='<img src="'+b.saving_image+'" alt="Saving..." />'}else{var i=b.saving_text}e.html(i);if(b.params!=""){b.params="&"+b.params}if(b.callback){html=b.callback(e.attr("id"),q,l,b.params);d=false;f=0;if(html){e.html(html||q)}else{alert("Failed to save value: "+q);e.html(l)}}else{if(b.value_required&&q==""){d=false;f=0;e.html(l);alert("Error: You must enter a value to save this field")}else{jQuery.ajax({url:b.url,type:b.method,data:b.update_value+"="+encodeURIComponent(q)+"&"+b.element_id+"="+e.attr("id")+b.params+"&"+b.original_html+"="+l,dataType:"html",complete:function(r){d=false;f=0},success:function(s){var r=s||b.default_text;e.html(r);if(b.success){b.success(s,e)}},error:function(r){e.html(l);if(b.error){b.error(r,e)}}})}}return false})}})})};